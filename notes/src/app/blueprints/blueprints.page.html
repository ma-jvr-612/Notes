<ion-header
  [translucent]="true"
  style="padding: 0.5rem; border-radius: 0.5rem; box-shadow: none"
>
  <ion-toolbar color="primary" style="border-radius: 0.5rem">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-searchbar
      [(ngModel)]="searchTerm"
      (ionInput)="searchBlueprints($event)"
      placeholder="Search recipes"
      animated="true"
    />
    <ion-buttons slot="end">
      <ion-button (click)="createNewBlueprint()">
        <ion-icon slot="icon-only" name="add"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-split-pane contentId="main-content">
    <ion-menu contentId="main-content">
      <ion-content>
        <ion-list lines="none">
          <ion-item
            *ngFor="let blueprint of filteredBlueprints"
            button
            (click)="selectBlueprint(blueprint)"
            [class.selected]="selectedBlueprint?.id === blueprint.id"
            detail="false"
          >
            <ion-label
              style="
                background: #fff5f2;
                border: 0.125rem solid #568f87;
                padding: 0.5rem;
                border-radius: 0.25rem;
                color: #568f87;
              "
            >
              <h2 style="font-weight: bold">{{ blueprint.title }}</h2>
              <p style="color: #568f87">{{ getPreview(blueprint.content) }}</p>
              <p class="blueprint-date" style="color: #064232">
                {{ formatDate(blueprint.updatedAt) }}
              </p>
            </ion-label>
          </ion-item>

          <ion-item *ngIf="filteredBlueprints.length === 0" lines="none">
            <ion-label class="ion-text-center">
              <p>No blueprints found</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ion-menu>

    <ion-content id="main-content">
      <div *ngIf="!selectedBlueprint" class="empty-state">
        <h2>No recipe selected</h2>
        <p>Select a recipe from the list or create a new one</p>
        <ion-button (click)="createNewBlueprint()" fill="outline">
          Create recipe
        </ion-button>
      </div>

      <div *ngIf="selectedBlueprint" class="editor">
        <ion-item lines="none" class="title-item">
          <ion-input
            [(ngModel)]="selectedBlueprint.title"
            (ionChange)="saveBlueprint()"
            placeholder="Blueprint title"
            class="blueprint-title"
          >
          </ion-input>
          <ion-button
            (click)="togglePreviewMode()"
            size="default"
            shape="round"
          >
            <ion-icon
              slot="icon-only"
              [name]="isPreviewMode ? 'brush' : 'logo-markdown'"
            ></ion-icon>
          </ion-button>
        </ion-item>

        <ion-item lines="none" class="content-item" *ngIf="!isPreviewMode">
          <ion-textarea
            [(ngModel)]="selectedBlueprint.content"
            (ionChange)="saveBlueprint()"
            placeholder="Start typing your blueprint"
            [autoGrow]="true"
            rows="20"
            class="blueprint-content"
          >
          </ion-textarea>
        </ion-item>

        <div *ngIf="isPreviewMode" class="markdown-preview">
          <div *ngFor="let line of previewLines">
            <h1 *ngIf="line.type === 'h1'" class="markdown-h1">
              {{ line.text }}
            </h1>
            <h2 *ngIf="line.type === 'h2'" class="markdown-h2">
              {{ line.text }}
            </h2>
            <h3 *ngIf="line.type === 'h3'" class="markdown-h3">
              {{ line.text }}
            </h3>
            <h4 *ngIf="line.type === 'h4'" class="markdown-h4">
              {{ line.text }}
            </h4>
            <h5 *ngIf="line.type === 'h5'" class="markdown-h5">
              {{ line.text }}
            </h5>
            <h6 *ngIf="line.type === 'h6'" class="markdown-h6">
              {{ line.text }}
            </h6>
            <div *ngIf="line.type === 'checkbox'" class="checkbox-item">
              <ion-checkbox
                [(ngModel)]="line.checked"
                (ionChange)="onCheckboxToggle(line)"
                class="markdown-checkbox"
              ></ion-checkbox>
              <span>{{ line.text }}</span>
            </div>
            <div *ngIf="line.type === 'text'" class="text-line">
              {{ line.text }}
            </div>
          </div>
        </div>

        <div class="editor-footer">
          <ion-text color="medium">
            <p style="color: #064232">
              Last saved: {{ formatDate(selectedBlueprint.updatedAt) }}
            </p>
          </ion-text>
          <ion-button
            color="danger"
            (click)="deleteBlueprint(selectedBlueprint)"
            fill="outline"
          >
            Delete
          </ion-button>
        </div>
      </div>
    </ion-content>
  </ion-split-pane>
</ion-content>
