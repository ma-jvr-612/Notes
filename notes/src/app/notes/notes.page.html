<ion-header
  [translucent]="true"
  style="padding: 0.5rem; border-radius: 0.5rem; box-shadow: none"
>
  <ion-toolbar color="primary" style="border-radius: 2rem">
    <ion-buttons slot="start">
      <ion-back-button
        defaultHref="/home"
        class="desktop-back-button"
      ></ion-back-button>
      @if (selectedNote) {
      <ion-back-button
        (click)="goBackToList()"
        class="mobile-only"
      ></ion-back-button>
      } @else {
      <ion-back-button
        defaultHref="/home"
        class="mobile-only"
      ></ion-back-button>
      }
    </ion-buttons>
    <ion-searchbar
      [(ngModel)]="searchTerm"
      (ionInput)="searchNotes($event)"
      placeholder="Search grocery lists"
      animated="true"
      class="search-bar desktop-search"
    />
    <ion-buttons slot="end">
      <ion-button (click)="createNewNote()">
        <ion-icon slot="icon-only" name="add"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-split-pane contentId="main-content">
    <!-- Notes List -->
    <ion-menu contentId="main-content" type="overlay">
      <ion-content>
        <ion-list lines="none">
          <ion-item
            *ngFor="let note of filteredNotes"
            button
            (click)="selectNote(note)"
            [class.selected]="selectedNote?.id === note.id"
            detail="false"
          >
            <ion-label
              style="
                background: #fff5f2;
                border: 0.125rem solid #568f87;
                padding: 0.5rem;
                border-radius: 0.25rem;
                color: #568f87;
              "
            >
              <h2 style="font-weight: bold">{{ note.title }}</h2>
              <p style="color: #568f87">{{ getPreview(note.content) }}</p>
              <p class="note-date" style="color: #064232">
                {{ formatDate(note.updatedAt) }}
              </p>
            </ion-label>
          </ion-item>

          <ion-item *ngIf="filteredNotes.length === 0" lines="none">
            <ion-label class="ion-text-center">
              <p>No grocery lists found</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ion-menu>

    <ion-content id="main-content" class="desktop-content">
      <!-- Mobile List View -->
      <div class="mobile-list-view">
        <ion-list lines="none">
          <ion-item
            *ngFor="let note of filteredNotes"
            button
            (click)="selectNote(note)"
            detail="false"
          >
            <ion-label
              style="
                background: #fff5f2;
                border: 0.125rem solid #568f87;
                padding: 0.5rem;
                border-radius: 0.25rem;
                color: #568f87;
              "
            >
              <h2 style="font-weight: bold">{{ note.title }}</h2>
              <p style="color: #568f87">{{ getPreview(note.content) }}</p>
              <p class="note-date" style="color: #064232">
                {{ formatDate(note.updatedAt) }}
              </p>
            </ion-label>
          </ion-item>

          <ion-item *ngIf="filteredNotes.length === 0" lines="none">
            <ion-label class="ion-text-center">
              <p>No grocery lists found</p>
              <ion-button (click)="createNewNote()" fill="outline">
                Create your first list
              </ion-button>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>

      <!-- Desktop Empty State -->
      <div *ngIf="!selectedNote" class="empty-state desktop-only-content">
        <h2>No grocery list selected</h2>
        <p>Select a grocery list from the list or create a new one</p>
        <ion-button (click)="createNewNote()" fill="outline">
          Create
        </ion-button>
      </div>

      <!-- Editor View (Desktop) or Detail View (Mobile) -->
      <div *ngIf="selectedNote" class="editor">
        <ion-item lines="none" class="title-item">
          <ion-input
            [(ngModel)]="selectedNote.title"
            (ionChange)="saveNote()"
            placeholder="Note title"
            class="note-title"
          >
          </ion-input>
          <ion-button
            (click)="togglePreviewMode()"
            size="default"
            shape="round"
          >
            <ion-icon
              slot="icon-only"
              [name]="isPreviewMode ? 'brush' : 'logo-markdown'"
            ></ion-icon>
          </ion-button>
        </ion-item>

        <ion-item lines="none" class="content-item" *ngIf="!isPreviewMode">
          <ion-textarea
            #contentTextarea
            [(ngModel)]="selectedNote.content"
            (ionChange)="saveNote()"
            (click)="onContentChange($event)"
            (keyup)="onContentChange($event)"
            (keydown)="onTextareaKeydown($event)"
            (ionFocus)="onContentFocus($event)"
            placeholder="Start typing your note"
            [autoGrow]="true"
            rows="20"
            class="note-content"
          >
          </ion-textarea>
        </ion-item>

        <div *ngIf="isPreviewMode" class="markdown-preview">
          <div *ngFor="let line of previewLines">
            <h1 *ngIf="line.type === 'h1'" class="markdown-h1">
              {{ line.text }}
            </h1>
            <h2 *ngIf="line.type === 'h2'" class="markdown-h2">
              {{ line.text }}
            </h2>
            <h3 *ngIf="line.type === 'h3'" class="markdown-h3">
              {{ line.text }}
            </h3>
            <h4 *ngIf="line.type === 'h4'" class="markdown-h4">
              {{ line.text }}
            </h4>
            <h5 *ngIf="line.type === 'h5'" class="markdown-h5">
              {{ line.text }}
            </h5>
            <h6 *ngIf="line.type === 'h6'" class="markdown-h6">
              {{ line.text }}
            </h6>
            <div *ngIf="line.type === 'checkbox'" class="checkbox-item">
              <ion-checkbox
                [(ngModel)]="line.checked"
                (ionChange)="onCheckboxToggle(line)"
                class="markdown-checkbox"
              ></ion-checkbox>
              <span>{{ line.text }}</span>
            </div>
            <div *ngIf="line.type === 'text'" class="text-line">
              {{ line.text }}
            </div>
          </div>
        </div>

        <div class="editor-footer">
          <ion-text color="medium">
            <p style="color: #064232">
              Last saved: {{ formatDate(selectedNote.updatedAt) }}
            </p>
          </ion-text>
          <div style="display: flex; gap: 0.5rem">
            <ion-button fill="outline" (click)="openBlueprintSelector()">
              Add recipe
            </ion-button>
            <ion-button
              color="danger"
              (click)="deleteNote(selectedNote)"
              fill="outline"
            >
              Delete
            </ion-button>
          </div>
        </div>
      </div>
    </ion-content>
  </ion-split-pane>
</ion-content>
